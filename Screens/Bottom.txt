import React, { useEffect, useState } from "react";
import {
  View,
  StyleSheet,
  Text,
  Image,
  FlatList,
  TouchableWithoutFeedback,
  TouchableOpacity,
  TextInput,
} from "react-native";
import {
  responsiveWidth,
  responsiveHeight,
} from "react-native-responsive-dimensions";
import FontAwesome5 from "react-native-vector-icons/FontAwesome5";
import { ScrollView } from "react-native-virtualized-view";
import axios from "axios";
import { useNavigation } from "@react-navigation/native";
import { api } from "./Api";
import Animated, { FadeInLeft, FadeInRight } from "react-native-reanimated";
import * as Location from "expo-location";
import { GooglePlacesAutocomplete } from "react-native-google-places-autocomplete";
import { googleapikey } from "./Api";
const Nearby = () => {
  const Api = api;

  const googleapi = googleapikey;
  const navigation = useNavigation();
  const [location, setLocation] = useState(null);
  const [errorMsg, setErrorMsg] = useState(null);
  const [apidata, setApiData] = useState("");
  const [address, setAddress] = useState([]);
  const [searchQuery, setSearchQuery] = useState("");
  useEffect(() => {
    (async () => {
      try {
        const { data } = await axios.get(`${Api}/matrimonial/profiles`);
        setApiData(data);
      } catch (error) {
        console.log(error);
      }
    })();
  }, []);

  useEffect(() => {
    (async () => {
      let { status } = await Location.requestForegroundPermissionsAsync();
      if (status !== "granted") {
        setErrorMsg("Permission to access location was denied");
        return;
      }

      let location = await Location.getCurrentPositionAsync({});
      setLocation(location);
      let geocode = await Location.reverseGeocodeAsync({
        latitude: location.coords.latitude,
        longitude: location.coords.longitude,
      });
      if (geocode && geocode.length > 0) {
        setAddress(geocode[0].name || geocode[0].street || "Unknown Location");
        console.warn(address);
      }
    })();
  }, []);

  const calculateAge = (dateOfBirth) => {
    const birthDate = new Date(dateOfBirth);
    const currentDate = new Date();
    const age = currentDate.getFullYear() - birthDate.getFullYear();
    if (
      currentDate.getMonth() < birthDate.getMonth() ||
      (currentDate.getMonth() === birthDate.getMonth() &&
        currentDate.getDate() < birthDate.getDate())
    ) {
      return age - 1;
    } else {
      return age;
    }
  };

  return (
    <ScrollView
      style={{ flex: 1 }}
      contentContainerStyle={{ paddingBottom: 130 }}
    >
      <View style={{}}>
        <View
          style={{
            backgroundColor: "#fff",

            marginBottom: 20,
            shadowColor: "#984065",
            shadowOffset: {
              width: 0,
              height: 50,
            },
            shadowOpacity: 0.8,
            shadowRadius: 16.0,
            elevation: 2,
          }}
        >
          <TextInput
            style={{
              width: "80%",
              backgroundColor: "#fff",
              borderRadius: 50,
              height: 45,
              marginBottom: 20,
              justifyContent: "center",
              top: responsiveHeight(1.5),
              alignSelf: "center",
              shadowColor: "#984065",
              shadowOffset: {
                width: 0,
                height: 50,
              },
              shadowOpacity: 0.8,
              shadowRadius: 16.0,
              elevation: 3,
              paddingLeft: 40,
              paddingRight: 20,
              right: responsiveWidth(7),
            }}
            placeholder="Matches near you"
          />
          <FontAwesome5
            name="map-pin"
            size={20}
            style={{
              position: "absolute",
              top: responsiveHeight(3.5),
              left: 25,
            }}
            color={"#4383f2"}
          />
          <GooglePlacesAutocomplete
            placeholder="Search"
            onPress={(data, details = null) => {
              // 'details' is provided when fetchDetails = true
              console.log(data, details);
            }}
            query={{
              key: 'AIzaSyB49L8Y4IP6YKlNy8QIH78Lc5sTbbjbpmk',
              language: "en",
            }}
          />
          <View
            style={{
              backgroundColor: "#fff",
              borderRadius: 50,
              height: 45,
              marginBottom: 20,
              justifyContent: "center",

              alignSelf: "center",
              shadowColor: "#984065",
              shadowOffset: {
                width: 0,
                height: 50,
              },
              shadowOpacity: 0.8,
              shadowRadius: 16.0,
              elevation: 3,
              paddingHorizontal: 13,
              right: responsiveWidth(3),
              position: "absolute",
              top: responsiveHeight(1.5),
            }}
          >
            <TouchableOpacity>
              <FontAwesome5
                name="search"
                size={20}
                style={{}}
                color={"#4383f2"}
              />
            </TouchableOpacity>
          </View>
        </View>

        <View style={{ flex: 1, marginTop: responsiveHeight(9) }}>
          <FlatList
            style={{}}
            data={apidata}
            keyExtractor={(item) => item._id}
            renderItem={({ item }) => (
              <>
                <View
                  style={{
                    alignSelf: "center",
                  }}
                >
                  <TouchableWithoutFeedback
                    onPress={() =>
                      navigation.navigate("Mymatchdata", { data: item })
                    }
                  >
                    <View
                      style={{
                        shadowColor: "black",
                        shadowOpacity: 0.9,
                        shadowRadius: 50,
                        elevation: 20,
                      }}
                    >
                      <Image
                        source={{ uri: item.image }}
                        style={{
                          width: responsiveWidth(90),
                          height: responsiveHeight(60),
                          bottom: 52,
                          marginTop: -20,
                          borderRadius: 10,
                          alignSelf: "center",
                        }}
                      />

                      <Animated.View
                        entering={FadeInLeft.duration(500).damping()}
                        style={{ left: responsiveWidth(13), bottom: 200 }}
                      >
                        <FontAwesome5
                          name="check-circle"
                          color={"green"}
                          size={18}
                          style={{ position: "absolute", left: -25, top: 3 }}
                        />
                        <Text
                          style={{
                            fontWeight: "600",
                            fontSize: 16,
                            color: "#fff",
                          }}
                        >
                          {item.profileId.firstName} {item.profileId.lastName}
                        </Text>
                        <Text
                          style={{
                            fontWeight: "600",
                            fontSize: 14,
                            color: "#fff",
                            top: 29,
                            position: "absolute",
                            left: -20,
                          }}
                        >
                          {calculateAge(item.profileId.dateOfBirth)} yrs, 5'2" .
                        </Text>
                        <Text
                          style={{
                            fontWeight: "600",
                            fontSize: 14,
                            color: "#fff",
                            top: 28,
                            position: "absolute",
                            left: 60,
                          }}
                        >
                          {item.educationAndCareer.workingWith}
                        </Text>
                        <Text
                          style={{
                            fontWeight: "600",
                            fontSize: 14,
                            color: "#fff",
                            top: 55,
                            position: "absolute",
                            left: -20,
                          }}
                        >
                          {item.locationOfGroom.countryLivingIn},Digambar .{" "}
                          {item.locationOfGroom.cityLivingIn},
                          {item.locationOfGroom.stateLivingIn}
                        </Text>
                      </Animated.View>
                      <Animated.View
                        entering={FadeInRight.duration(500).damping()}
                        style={{
                          position: "absolute",
                          left: responsiveWidth(75),
                        }}
                      >
                        <TouchableOpacity onPress={{}} style={{}}>
                          <Text
                            style={{
                              color: "#fff",
                              fontSize: 35,
                              bottom: 60,
                            }}
                          >
                            ...
                          </Text>
                        </TouchableOpacity>
                      </Animated.View>
                      <View
                        style={{
                          borderWidth: 0.5,
                          paddingHorizontal: responsiveWidth(44),
                          alignSelf: "center",
                          top: responsiveHeight(-17),
                          borderColor: "#fff",
                          opacity: 0.8,
                        }}
                      ></View>
                      <View style={{ bottom: responsiveHeight(15), left: 30 }}>
                        <Text style={{ color: "#fff", fontWeight: 500 }}>
                          Like this Profile?
                        </Text>
                        <Text
                          style={{
                            color: "lightblue",
                            fontWeight: 500,
                            position: "absolute",
                            left: 120,
                            fontSize: 17,
                            bottom: 1,
                          }}
                          onPress={{}}
                        >
                          Connect Now
                        </Text>
                        <TouchableOpacity
                          style={{
                            backgroundColor: "pink",
                            position: "absolute",
                            shadowColor: "#000",
                            shadowOpacity: 0.6,
                            shadowRadius: 10,
                            elevation: 20,
                            padding: 10,
                            left: responsiveWidth(64),
                            bottom: 10,
                            borderRadius: 50,
                          }}
                        >
                          <FontAwesome5
                            name="check"
                            size={30}
                            style={{}}
                            color={"#fff"}
                          />
                        </TouchableOpacity>
                      </View>
                    </View>
                  </TouchableWithoutFeedback>
                </View>
              </>
            )}
            showsHorizontalScrollIndicator={false}
          />
        </View>
      </View>
    </ScrollView>
  );
};

export default Nearby;
const styles = StyleSheet.create({
  inputView: {
    width: "90%",
    backgroundColor: "#fff",
    borderRadius: 50,
    height: 50,
    marginBottom: 20,
    justifyContent: "center",
    padding: 20,
    top: responsiveHeight(6),
    alignSelf: "center",
    shadowColor: "#984065",
    shadowOffset: {
      width: 0,
      height: 50,
    },
    shadowOpacity: 0.8,
    shadowRadius: 16.0,
    elevation: 5,
    paddingLeft: 30,
    paddingRight: 50,
  },
  inputText: {
    height: 50,
    color: "black",
  },
});


  <View style={styles.inputView}>
            <TextInput
              style={styles.inputText}
              placeholder="Search..."
              placeholderTextColor="black"
              edile={true}
              onChangeText={(txt) => setSearchQuery(txt)}
              value={searchQuery}
            />

            <TouchableOpacity
              onPress={() => getRecipes()}
              style={{
                left: responsiveWidth(78),
                bottom: 15,
                position: "absolute",
              }}
            >
              <FontAwesome5 size={20} name="search" color={"#704a93"} />
            </TouchableOpacity>
          </View>









